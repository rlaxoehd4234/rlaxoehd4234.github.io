---
title: "운영체제와 DB 세션의 진짜 비용: 커넥션 풀 심화 탐구"
date: "2025-09-03"
author: "남성"
image: "https://tse2.mm.bing.net/th/id/OIP.WjDVH8u5aCImfOq39oMMHwHaF7?pid=Api"
description: "요청 스레드부터 DB 세션까지, 운영체제와 데이터베이스 레벨에서 발생하는 커넥션 관리 비용을 심층 분석"
---

# 운영체제와 DB 세션의 진짜 비용: 커넥션 풀 심화 탐구

![DB Connection Pool 구조](https://tse2.mm.bing.net/th/id/OIP.WjDVH8u5aCImfOq39oMMHwHaF7?pid=Api)

---

## 0. 요청 처리 흐름: 스레드에서 세션까지 한 사이클

1. **HTTP 요청 수신**
   - 톰캣이 요청을 받으면 워커 스레드 하나가 할당됩니다.
   - 이 스레드는 실제 OS 스레드와 1:1 매핑됩니다.

2. **커넥션 풀 접근**
   - 워커 스레드는 DB 접근 시 HikariCP 같은 커넥션 풀에서 커넥션을 빌립니다.
   - 풀에 남은 커넥션이 없다면 대기열에 들어갑니다.

3. **DB 세션 매핑**
   - 풀에서 얻은 커넥션은 DB 서버에 열려 있는 세션과 연결됩니다.
   - 세션에는 인증 정보, 트랜잭션, 커서, 캐시 포인터 등이 포함됩니다.

4. **쿼리 실행**
   - DB 서버의 스레드/프로세스가 쿼리를 실행합니다.
   - OS 레벨에서는 DBMS 내부 스레드가 CPU에서 동작합니다.

5. **커넥션 반납**
   - 작업이 끝나면 커넥션을 닫지 않고 풀에 다시 반납합니다.
   - 이때 트랜잭션 종료 및 세션 초기화가 이루어집니다.

6. **요청 스레드 종료**
   - 응답을 반환하고 워커 스레드는 풀에 대기 상태로 복귀합니다.

---

## 1. 운영체제 레벨 리소스 소모

- **워커 스레드**: OS 스레드와 1:1 매핑, 많아질수록 문맥 전환 비용 증가.  
- **네트워크 소켓**: 각 커넥션마다 커널 메모리와 버퍼를 차지, FD 한계에 영향.  

---

## 2. DBMS 레벨 리소스 소모

- **세션(Session)**: 트랜잭션 상태, 인증 정보, 락 관리, 캐시 포인터를 보관 → 메모리 사용 증가.  
- **스레드/프로세스**: DBMS는 연결당 스레드/프로세스를 생성 → 대규모 연결 시 문맥 전환 폭증.  
- **락/트랜잭션 매니저**: 세션 수가 많을수록 락 동기화 비용 증가.  
- **보안/로그**: 각 세션마다 권한 검증과 감사 로그 기록이 추가 부담.  

---

## 3. 커넥션 풀의 필요성과 역할

- **생성 비용 절감**: 매번 새 커넥션을 열면 핸드셰이크 + 인증으로 10~100ms 지연 발생.  
- **재사용 효과**: 커넥션을 재활용해 빠른 응답 제공.  
- **스로틀링**: 풀 크기를 제한해 DB가 감당 가능한 수준을 넘지 않게 제어.  

---

## 4. 운영 전략: 톰캣 스레드 vs DB 커넥션 풀

- **톰캣 스레드 (`maxThreads`)**: CPU 코어 수 × 10~20 수준까지 확장 가능.  
- **DB 커넥션 풀 (`maximumPoolSize`)**: CPU 코어 수 × 2~4 수준 권장 (보통 20~50개).  

---

## 5. 종합 테이블

| 범주              | 리소스 사용                           | 병목 지점                        |
|-------------------|--------------------------------------|---------------------------------|
| 톰캣 워커 스레드   | OS 스레드, CPU 문맥 전환 비용          | 스레드 수 과다 시 CPU 오버헤드     |
| 커넥션 풀          | TCP 소켓, DB 세션 매핑                 | 풀 크기 이상 대기 발생             |
| DB 세션           | 메모리, 트랜잭션, 커서, 락 관리         | 세션 수 과다 시 락/캐시 부하        |
| DB 스레드/프로세스 | OS 스레드/프로세스 자원, 스케줄링 비용  | 1000개 이상 연결 시 성능 급격 저하  |

---

## 결론

DB 커넥션은 단순한 소켓 연결이 아닙니다.  
운영체제 리소스(스레드, 소켓, 커널 메모리)와 DBMS 내부 자원(세션, 락, 프로세스)을 복합적으로 소비합니다.  

따라서 커넥션 풀은 **재사용(성능 최적화)**과 **제한(부하 제어)**이라는 두 가지 측면에서 필수적인 인프라입니다.  
안정적인 시스템 운영을 위해 톰캣 스레드 수와 DB 커넥션 풀 크기를 CPU/메모리 자원에 맞춰 균형 있게 설정하는 것이 핵심입니다.
