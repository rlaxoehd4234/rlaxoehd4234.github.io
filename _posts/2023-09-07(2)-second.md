---
layout: single
title: Spring Bean 과 CGLIB 내용 
---


### 개요 
이 글을 시작하기 전에 먼저 필자는 Spring Bean 으로 등록되어서 관리되는 것들은 모두 proxy 객체인가 라는 의문에서 시작되었다. 

여러가지 글을 찾아보게 되었습니다. 우서 결론적으로 말하면 Spring Bean 은 필요한 경우에만 Proxy 객체로 만들어진다는 것이다. 

### Proxy Bean 과 Bean 


Proxy 클래스가 Bean 으로 관리되는 경우와 아닌 경우의 차이 
이 차이는 SpringContext 가 Bean 후보들을 스캔하여 Bean으로 생성하려고 할때 구분이 된다. 
빈이 생성되는 과정에서 AbstractAutoProxyCreator.wrapIfNecessary() 함수가 호출 되는데 이름에서 알 수 있듯이 필요한 경우에
Bean 으로 만들고자 하는 클래스를 Proxy 로 Wrap 역할을 수행하는 함수이다. 

아직 필자가 AbstractAutoProxyCreator.wrapIfNecessary() 이 메서드의 로직을 이해하지 못해서 세부적인 부분에 대해서는 설명이 어려울거 같다.

결론적으로 Bean 으로 등록하고자 하는 Class 에 interceptor 가 존재하는지 확인하고 interceptor 가 없다면 객체를 그대로 리턴하고 interceptor 가 필요하다면 proxy 객체를 만들어 리턴한다. 



위의 과정이 끝나고 target 클래스를 Proxy 로 wrapping 하기로 결정했다면 
CGLIB 으로 감싸줄것인지, Dynamic Proxy 로 감싸 줄것인지를 결정하게 된다. 


타겟 클래스가 Dynamic Proxy 로 만들어지는 경우는 3가지가 있다. 
1. target class 가 interface 인 경우
2. target class 가 proxy class 인 경우
3. target class 가 Lambda class 인 경우 

Dynamic Proxy 가 만들어진다. 



CGLIB Proxy 는 어떻게 생성될까 ?
Proxy class 는 런타임에 생성된다. 즉, 새로운 java Class 가 런타임에 생성되는 것이다. 



## 결론
Spring 은 CGLIB 과 Dynamic Proxy 모두 사용하고 있으며 어떤걸 사용할지는 조건에 따라 다르다 CGLIB 은 Proxy Class 를 만들때 TargetClass 를 부모로 가지는 SubClass 를 만들기 때문에 DI 가 가능하다. 













## 출처
https://woooongs.tistory.com/99